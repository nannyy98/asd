{% extends "base.html" %}

{% block title %}–ê–≤—Ç–æ–ø–æ—Å—Ç—ã - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}
{% block page_title %}–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å—Ç—ã{% endblock %}

{% block content %}
<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–≤ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h5 class="alert-heading">
                <i class="fas fa-info-circle me-2"></i>
                –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–≤
            </h5>
            <p class="mb-2">
                <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:</strong> 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –≤ 09:00, 14:00 –∏ 19:00
            </p>
            <p class="mb-2">
                <strong>–ö–∞–Ω–∞–ª:</strong> -1002566537425 (–ø—É–±–ª–∏—á–Ω—ã–µ –ø–æ—Å—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏)
            </p>
            <p class="mb-0">
                <strong>–ö–æ–Ω—Ç–µ–Ω—Ç:</strong> –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –∞–∫—Ü–∏–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏
            </p>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <button type="button" class="btn btn-success w-100" onclick="sendTemplatePost('morning_greeting')">
                            <i class="fas fa-sun me-2"></i>
                            –£—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button type="button" class="btn btn-warning w-100" onclick="sendTemplatePost('afternoon_promo')">
                            <i class="fas fa-fire me-2"></i>
                            –î–Ω–µ–≤–Ω–∞—è –∞–∫—Ü–∏—è
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button type="button" class="btn btn-info w-100" onclick="sendTemplatePost('evening_recommendations')">
                            <i class="fas fa-moon me-2"></i>
                            –í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button type="button" class="btn btn-danger w-100" onclick="sendTemplatePost('flash_sale')">
                            <i class="fas fa-bolt me-2"></i>
                            –§–ª–µ—à-—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞
                        </button>
                    </div>
                </div>
                
                <hr>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <button type="button" class="btn btn-outline-primary w-100" onclick="sendTemplatePost('weekend_sale')">
                            <i class="fas fa-calendar-weekend me-2"></i>
                            –í—ã—Ö–æ–¥–Ω—ã–µ —Å–∫–∏–¥–∫–∏
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button type="button" class="btn btn-outline-success w-100" onclick="sendTemplatePost('new_arrivals')">
                            <i class="fas fa-star me-2"></i>
                            –ù–æ–≤–∏–Ω–∫–∏ –Ω–µ–¥–µ–ª–∏
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button type="button" class="btn btn-outline-info w-100" onclick="showCustomPostModal()">
                            <i class="fas fa-edit me-2"></i>
                            –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ—Å—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–≤ -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–≤
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 text-center">
                        <div class="card border-warning">
                            <div class="card-body">
                                <i class="fas fa-sun fa-3x text-warning mb-3"></i>
                                <h5>–£—Ç—Ä–æ–º</h5>
                                <h3 class="text-primary">09:00</h3>
                                <p class="text-muted">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è</p>
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 text-center">
                        <div class="card border-info">
                            <div class="card-body">
                                <i class="fas fa-sun fa-3x text-info mb-3"></i>
                                <h5>–î–Ω–µ–º</h5>
                                <h3 class="text-primary">14:00</h3>
                                <p class="text-muted">–ê–∫—Ü–∏–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</p>
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 text-center">
                        <div class="card border-primary">
                            <div class="card-body">
                                <i class="fas fa-moon fa-3x text-primary mb-3"></i>
                                <h5>–í–µ—á–µ—Ä–æ–º</h5>
                                <h3 class="text-primary">19:00</h3>
                                <p class="text-muted">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –∏—Ç–æ–≥–∏</p>
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-success mt-4">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>–ê–≤—Ç–æ–ø–æ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç!</strong> –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å—Ç—ã 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.
                    –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏.
                </div>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie me-2"></i>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <h2 class="text-success">21</h2>
                    <p class="text-muted">–ø–æ—Å—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</p>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>üåÖ –£—Ç—Ä–µ–Ω–Ω–∏–µ:</span>
                        <strong>7</strong>
                    </div>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-warning" style="width: 33%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ:</span>
                        <strong>7</strong>
                    </div>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-info" style="width: 33%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>üåô –í–µ—á–µ—Ä–Ω–∏–µ:</span>
                        <strong>7</strong>
                    </div>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-primary" style="width: 33%"></div>
                    </div>
                </div>
                
                <hr>
                
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-success btn-sm" onclick="testChannelConnection()">
                        <i class="fas fa-wifi me-1"></i>
                        –¢–µ—Å—Ç –∫–∞–Ω–∞–ª–∞
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="viewDetailedStats()">
                        <i class="fas fa-chart-line me-1"></i>
                        –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-history me-1"></i>
                    –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã
                </h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">–í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h6>
                            <small class="text-muted">–°–µ–≥–æ–¥–Ω—è –≤ 19:00</small>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">–î–Ω–µ–≤–Ω–∞—è –∞–∫—Ü–∏—è</h6>
                            <small class="text-muted">–°–µ–≥–æ–¥–Ω—è –≤ 14:00</small>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">–£—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</h6>
                            <small class="text-muted">–°–µ–≥–æ–¥–Ω—è –≤ 09:00</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ -->
<div class="modal fade" id="customPostModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>
                    –°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ—Å—Ç
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="customPostForm">
                    <div class="mb-3">
                        <label for="custom_title" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞</label>
                        <input type="text" class="form-control" id="custom_title" 
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="custom_content" class="form-label">–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞</label>
                        <textarea class="form-control" id="custom_content" rows="6" 
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..." required></textarea>
                        <div class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ —ç–º–æ–¥–∑–∏</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="custom_image" class="form-label">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="url" class="form-control" id="custom_image" 
                               placeholder="https://images.pexels.com/photos/...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="sendCustomPost()">
                    <i class="fas fa-paper-plane me-2"></i>
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function sendTemplatePost(templateType) {
    if (confirm(`–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç "${templateType}" –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?`)) {
        fetch('/api/send_template_post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                template_type: templateType
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ –ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª!');
            } else {
                alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + data.error);
            }
        })
        .catch(error => {
            alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å—Ç–∞');
        });
    }
}

function showCustomPostModal() {
    const modal = new bootstrap.Modal(document.getElementById('customPostModal'));
    modal.show();
}

function sendCustomPost() {
    const title = document.getElementById('custom_title').value;
    const content = document.getElementById('custom_content').value;
    const image = document.getElementById('custom_image').value;
    
    if (!title || !content) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞');
        return;
    }
    
    fetch('/api/send_custom_post', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            title: title,
            content: content,
            image_url: image
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
            bootstrap.Modal.getInstance(document.getElementById('customPostModal')).hide();
            document.getElementById('customPostForm').reset();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + data.error);
        }
    })
    .catch(error => {
        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å—Ç–∞');
    });
}

function testChannelConnection() {
    fetch('/api/test_channel', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–Ω–∞–ª!');
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª: ' + data.error);
        }
    })
    .catch(error => {
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–Ω–∞–ª–∞');
    });
}

function viewDetailedStats() {
    alert('üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–≤:\n\n' +
          '‚Ä¢ –£—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Å—Ç—ã: 100% –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å\n' +
          '‚Ä¢ –î–Ω–µ–≤–Ω—ã–µ –∞–∫—Ü–∏–∏: 98% –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å\n' +
          '‚Ä¢ –í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: 99% –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å\n\n' +
          '–°—Ä–µ–¥–Ω—è—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å: 15-20% –æ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤');
}
</script>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    top: 5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.timeline-item:not(:last-child)::before {
    content: '';
    position: absolute;
    left: -29px;
    top: 17px;
    width: 2px;
    height: calc(100% + 5px);
    background-color: #dee2e6;
}

.timeline-content h6 {
    margin-bottom: 2px;
    font-weight: 600;
}
</style>
{% endblock %}